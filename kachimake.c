#include <stdio.h>
#include <string.h>
#include "./kachimake.h"

void win(int board[BOARD_SQUARE][BOARD_SQUARE], int x, int y, char *message)
{
    if(judgeWin(board, x, y))
    {
        printf(",win\n");
        strcat(message, ",win");
    }
}

/* ã‚²ãƒ¼ãƒ?ã®å‹ã¡è²?ã‘ã‚’åˆ¤å®šã™ã‚?
 * int board[BOARD_SQUARE][BOARD_SQUARE] : æ‰‹ã‚’å‡ºã™å‰ã®ç›¤ã®çŠ¶æ…? 
 * int x : å‡ºã—ãŸæ‰‹ã?®xåº§æ¨?
 * int y : å‡ºã—ãŸæ‰‹ã?®yåº§æ¨? (ä»Šå?ºã—ãŸæ‰‹ã?¯board[x-1][y-1]ã®ä½ç½®ã«ãªã‚‹ã£ã½ã?) 
 * ã“ã?®æ‰‹ã§å‹ã¦ã‚‹ãªã‚?1ã‚’ï¼Œå‹ã¦ãªã?ãªã‚?0ã‚’è¿”ã™
 */
int judgeWin(int board[BOARD_SQUARE][BOARD_SQUARE], int x, int y)
{
    // ç¸¦ã«ä¸¦ã¶ã‹åˆ¤å®šã™ã‚?
    if(judgeVertical(board, x, y)) return 1;
    // æ¨ªã«ä¸¦ã¶ã‹åˆ¤å®šã™ã‚?
    if(judgeWidth(board, x, y)) return 1;
    // æ–œã‚ã«ä¸¦ã¶ã‹åˆ¤å®šã™ã‚?
    if(judgeDiagonal(board, x, y)) return 1;
    return 0;
}

/* ç¸¦ã«5ã¤ä¸¦ã¶ã‹åˆ¤å®šã™ã‚?
 * board : ç›¤ã®çŠ¶æ…?
 * x : å‡ºã—ãŸæ‰‹ã?®xåº§æ¨?
 * y : å‡ºã—ãŸæ‰‹ã?®yåº§æ¨?
 * ç¸¦ã«5ã¤ä¸¦ã‚“ã§ã?ãŸã‚‰1ã‚’ï¼Œä¸¦ã‚“ã§ã?ãªã‹ã£ãŸã‚‰0ã‚’è¿”ã™
 */
int judgeVertical(int board[BOARD_SQUARE][BOARD_SQUARE], int x, int y)
{
    int cnt = 1; // ä¸¦ã‚“ã§ã?ã‚‹æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚?
    int i, x2 = x-1, y2 = y-2;
    // x-1, y-1ã‹ã‚‰ä¸Šæ–¹å‘ï¼Œä¸‹æ–¹å‘ã?®é ?ç•ªã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã—ã¦ã?ã?
    // ä¸Šæ–¹å‘ã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã€‚æœ€å¤§4å€?([x-1][y-1]ã‚’é™¤ãã?®ã§)
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    for(i=0; i<4;i++)
    {
        if(board[x2][y2]==1 && y2-->=0) cnt++;
        else break;
    }
    if(cnt==5) return 1;
    // ä¸‹æ–¹å‘ã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã€‚æœ€å¤§4å€?([x-1][y-1]ã‚’é™¤ãã?®ã§)
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    y2 = y;
    for(i=0;i<4;i++)
    {
        if(board[x2][y2]==1 && y2++<BOARD_SQUARE) cnt++;
        else break;
    }
    if(cnt==5) return 1;
    return 0;
}

/* æ¨ªã«5ã¤ä¸¦ã¶ã‹åˆ¤å®šã™ã‚?
 * board : ç›¤ã®çŠ¶æ…?
 * x : å‡ºã—ãŸæ‰‹ã?®xåº§æ¨?
 * y : å‡ºã—ãŸæ‰‹ã?®yåº§æ¨?
 * æ¨ªã«5ã¤ä¸¦ã‚“ã§ã?ãŸã‚‰1ã‚’ï¼Œä¸¦ã‚“ã§ã?ãªã‹ã£ãŸã‚‰0ã‚’è¿”ã™
 */
int judgeWidth(int board[BOARD_SQUARE][BOARD_SQUARE], int x, int y)
{
    int cnt = 1; // ä¸¦ã‚“ã§ã‚‹æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚?
    int i, x2 = x-2, y2 = y-1;
    // x-1, y-1ã‹ã‚‰å·¦æ–¹å‘ï¼Œå³æ–¹å‘ã?®é ?ç•ªã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã—ã¦ã?ã?
    // å·¦æ–¹å‘ã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã€‚æœ€å¤§4å€?([x-1][y-1]ã‚’é™¤ãã?®ã§)
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    for(i=0; i<4;i++)
    {
        if(board[x2][y2]==1 && x2-->=0) cnt++;
        else break;
    }
    if(cnt==5) return 1;
    // å³æ–¹å‘ã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã€‚æœ€å¤§4å€?([x-1][y-1]ã‚’é™¤ãã?®ã§)
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    x2 = x;
    for(i=0;i<4;i++)
    {
        if(board[x2][y2]==1 && x2++<BOARD_SQUARE) cnt++;
        else break;
    }
    if(cnt==5) return 1;
    return 0;
}

/* æ–œã‚ã«5ã¤ä¸¦ã¶ã‹åˆ¤å®šã™ã‚?
 * board : ç›¤ã®çŠ¶æ…?
 * x : å‡ºã—ãŸæ‰‹ã?®xåº§æ¨?
 * y : å‡ºã—ãŸæ‰‹ã?®yåº§æ¨?
 * æ–œã‚ã«5ã¤ä¸¦ã‚“ã§ã?ãŸã‚‰1ã‚’ï¼Œä¸¦ã‚“ã§ã?ãªã‹ã£ãŸã‚‰0ã‚’è¿”ã™
 */
int judgeDiagonal(int board[BOARD_SQUARE][BOARD_SQUARE], int x, int y)
{
    int cnt = 1; // ä¸¦ã‚“ã§ã‚‹æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚?
    // x-1, y-1ã‹ã‚‰å³æ–œã‚ã€å·¦æ–œã‚ã®é ?ç•ªã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã—ã¦ã?ãã„ã?
    // å·¦ä¸‹ã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã€‚æœ€å¤§4å€?([x-1][y-1]ã‚’é™¤ãã?®ã§)
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    int i, x2 = x-2, y2 = y;
    for(i=0; i<4;i++)
    {
        if(board[x2][y2]==1 && x2-->=0 && y2++<BOARD_SQUARE) cnt++;
        else break;
    }
    if(cnt==5) return 1;
    // å³ä¸Šã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã™ã‚?
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    x2 = x; y2 = y-2;
    for(i=0; i<4;i++)
    {
        if(board[x2][y2]==1 && x2++<BOARD_SQUARE && y2-->=0) cnt++;
        else break;
    }
    if(cnt==5) return 1;

    // å³ä¸‹ã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã™ã‚?
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    cnt = 1; x2 = x; y2 = y;
    for(i=0;i<4;i++)
    {
        if(board[x2][y2]==1 && x2++<BOARD_SQUARE && y2++<BOARD_SQUARE) cnt++;
        else break;
    }
    if(cnt==5) return 1;
    
    // å·¦ä¸Šã«ä½•å€‹ä¸¦ã¶ã‹ç¢ºèªã™ã‚?
    // ä»®ã«boardã«ä½•ã‚‚ãªã?ã¨ã“ã‚ã¯0ã€è?ªåˆ?ãŒç½®ã?ãŸã¨ã“ã‚ã¯1ã€ç›¸æ‰‹ãŒç½®ã?ãŸã¨ã“ã‚ã¯2ã§æ ¼ç´ã•ã‚Œã¦ã?ã‚‹ã¨ã™ã‚‹
    x2 = x-2; y2 = y-2;
    for(i=0;i<4;i++)
    {
        if(board[x2][y2]==1 && x2-->=0 && y2-->=0) cnt++;
        else break;
    }
    if(cnt==5) return 1;

    return 0;
}